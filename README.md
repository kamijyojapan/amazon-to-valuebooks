# Amazon to Value Books Checker 📚

Amazon.co.jp の書籍ページを開いた際に、古本買取・販売サイト「[バリューブックス](https://www.valuebooks.jp/)」の在庫状況と価格を自動で検索し、結果を通知バーで表示する UserScript です。

## ✨ 特徴

* **自動在庫チェック**: Amazonの商品ページを開くだけで、裏側でバリューブックスの在庫を確認します。

* **正確な価格表示**: バリューブックスの公式APIを使用しているため、リアルタイムの正確な販売価格（最安値）を表示します。

* **高度な検索ロジック**: 表記ゆれに強い「4段階の検索フェイルセーフ」を搭載。

  * 巻数付きのコミックや、副題の長い実用書なども高い精度でヒットさせます。

  * 「Kindle版」や「文庫」などのノイズ文字を自動除去して検索します。

* **3つのステータス表示**:

  * 🟢 **在庫あり**: 販売価格を表示し、クリックで商品ページへ飛びます。

  * ⚪ **在庫切れ**: 取り扱いはあるが入荷待ちであることを通知します。

  * 🔵 **見つからない**: 検索ワードを修正して手動検索できるバーを表示します。

* **レスポンシブデザイン**: PCはもちろん、スマホやタブレットの狭い画面でもレイアウトが崩れません。

## 📥 インストール方法

このスクリプトを使用するには、ブラウザに UserScript マネージャーが必要です。

1. **拡張機能のインストール**:

   * [Tampermonkey](https://www.tampermonkey.net/) (Chrome, Edge, Safari, Firefox)

   * または [Violentmonkey](https://violentmonkey.github.io/)

2. **スクリプトのインストール**:

   * [Greasy Fork からインストール](https://greasyfork.org/ja/scripts/your-script-id) (※公開後にリンクを貼ってください)

   * または、GitHubのファイル一覧にある `.user.js` をクリックして「Raw」ボタンを押すとインストール画面が開きます。

## 🚀 使い方

1. Amazon.co.jp で任意の書籍（紙の本、Kindle問わず）の詳細ページを開きます。

2. ページ読み込み後、商品タイトルの下あたりに**通知バー**が表示されます。

3. バーをクリックすると、バリューブックスの該当ページが新しいタブで開きます。

### 表示例

| 状態 | 色 | 表示内容 | 
 | ----- | ----- | ----- | 
| **在庫あり** | 🟢 緑 | `📚 バリューブックス在庫あり: 1,100円` | 
| **在庫切れ** | ⚪ 灰 | `📖 バリューブックス：現在在庫切れ` | 
| **ヒットなし** | 🔵 青 | `🔍 バリューブックス検索: [入力欄]` | 

<img width="2396" height="1230" alt="image" src="https://github.com/user-attachments/assets/0c1e63f3-d871-4aaa-ba90-386f060deab7" />

## 🛠 技術的な仕組み

このスクリプトは、Amazon上のタイトルと著者名を利用して、以下の手順で商品を特定します。

1. **タイトルの正規化**: `(文庫)` `[Kindle版]` などの不要な文字列を削除しますが、コミックの巻数 `(12)` などは保持します。

2. **4段階の検索リトライ**:

   * **Level 1**: `"タイトル" 著者名` （完全一致＋著者指定）

   * **Level 2**: `"タイトル"` （完全一致）

   * **Level 3**: `タイトル` （あいまい検索・表記ゆれ許容）

   * **Level 4**: `メインタイトル` （副題を削除して検索）

3. **類似度判定**: ヒットした商品のタイトルとAmazonのタイトルを比較（レーベンシュタイン距離）し、全く違う商品が誤って表示されるのを防ぎます。

## 🛡 プライバシーと権限

* **通信先**: 在庫確認のために `www.valuebooks.jp` へアクセスします。それ以外の外部サイトへデータを送信することはありません。

* **権限**: クロスオリジン通信を行うため `GM_xmlhttpRequest` 権限を使用しています。

## 📄 ライセンス

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

### Author

Designed & Developed by You
